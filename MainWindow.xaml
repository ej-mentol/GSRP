<Window x:Class="GSRP.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:GSRP.ViewModels"
        xmlns:conv="clr-namespace:GSRP.Converters"
        xmlns:view="clr-namespace:GSRP.View.Views"
        xmlns:shell="clr-namespace:System.Windows.Shell;assembly=PresentationFramework"
        xmlns:ui="http://schemas.modernwpf.com/2019"
        Title="GSRP"
        Width="1000" Height="800"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        ResizeMode="CanResize"
        Background="#1e1f23">

    <shell:WindowChrome.WindowChrome>
        <shell:WindowChrome
            CaptionHeight="48"
            ResizeBorderThickness="8"
            GlassFrameThickness="0"
            UseAeroCaptionButtons="False" />
    </shell:WindowChrome.WindowChrome>

    

    <Window.Resources>
        <conv:EqualityToVisibilityConverter x:Key="EqualityToVisibilityConverter"/>
    </Window.Resources>

    <Grid>
        <Border Background="#1e1f23"
                CornerRadius="12"
                BorderBrush="#2d2e33"
                BorderThickness="0">

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <Border Grid.Row="0"
                        Background="#141518"
                        CornerRadius="12,12,0,0"
                        BorderThickness="0,0,0,1"
                        BorderBrush="#2d2e33"
                        Padding="20,12">

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Left Panel (Logo and Title) -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Left">
                            <Border Width="36" Height="36" CornerRadius="8" Margin="0,0,12,0">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#2a2050" Offset="0"/>
                                        <GradientStop Color="#00f0ff" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <Path Data="M12 2L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5L12 2z" 
                                      Fill="White" 
                                      Stretch="Uniform" 
                                      Width="18" 
                                      HorizontalAlignment="Center" 
                                      VerticalAlignment="Center"/>
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="GSRP" Foreground="#f2f2f2" FontSize="16" FontWeight="SemiBold"/>
                                <TextBlock Text="{Binding StatusMessage}" FontSize="11">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="#a6a8ab"/>
                                            <Setter Property="FontWeight" Value="Normal"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding StatusMessage}" Value="Processing...">
                                                    <Setter Property="Foreground" Value="#22c55e"/>
                                                    <Setter Property="FontWeight" Value="Medium"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding StatusMessage}" Value="Parsing player list...">
                                                    <Setter Property="Foreground" Value="#22c55e"/>
                                                    <Setter Property="FontWeight" Value="Medium"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding StatusMessage}" Value="Updating player list...">
                                                    <Setter Property="Foreground" Value="#22c55e"/>
                                                    <Setter Property="FontWeight" Value="Medium"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding StatusMessage}" Value="Enriching data...">
                                                    <Setter Property="Foreground" Value="#22c55e"/>
                                                    <Setter Property="FontWeight" Value="Medium"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                        </StackPanel>

                        <!-- Center Panel (Search Box) -->
                        <Grid Grid.Column="1" Width="300">
                            <TextBox x:Name="MainSearchBox" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" 
                                     Style="{StaticResource {x:Type TextBox}}"
                                     shell:WindowChrome.IsHitTestVisibleInChrome="True">
                                <TextBox.ContextMenu>
                                    <ContextMenu Style="{StaticResource ThemedContextMenu}">
                                        <MenuItem Command="ApplicationCommands.Cut" Header="Cut" Style="{StaticResource ThemedMenuItem}">
                                            <MenuItem.Icon>
                                                <Border Background="#ef4444" CornerRadius="3" Width="16" Height="16">
                                                    <TextBlock Text="✂️" Foreground="White" FontSize="10" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                            </MenuItem.Icon>
                                        </MenuItem>
                                        <MenuItem Command="ApplicationCommands.Copy" Header="Copy" Style="{StaticResource ThemedMenuItem}">
                                            <MenuItem.Icon>
                                                <Border Background="#3b82f6" CornerRadius="3" Width="16" Height="16">
                                                    <TextBlock Text="📋" Foreground="White" FontSize="10" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                            </MenuItem.Icon>
                                        </MenuItem>
                                        <MenuItem Command="ApplicationCommands.Paste" Header="Paste" Style="{StaticResource ThemedMenuItem}">
                                            <MenuItem.Icon>
                                                <Border Background="#10b981" CornerRadius="3" Width="16" Height="16">
                                                    <TextBlock Text="📄" Foreground="White" FontSize="10" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                            </MenuItem.Icon>
                                        </MenuItem>
                                        <Separator/>
                                        <MenuItem Command="ApplicationCommands.SelectAll" Header="Select All" Style="{StaticResource ThemedMenuItem}">
                                            <MenuItem.Icon>
                                                <Border Background="#60a5fa" CornerRadius="3" Width="16" Height="16">
                                                    <ui:FontIcon Glyph="&#xE8B3;" FontSize="10"  HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                            </MenuItem.Icon>
                                        </MenuItem>
                                        <MenuItem Command="ApplicationCommands.Delete" Header="Delete" Style="{StaticResource ThemedMenuItem}">
                                            <MenuItem.Icon>
                                                <Border Background="#ef4444" CornerRadius="3" Width="16" Height="16">
                                                    <ui:FontIcon Glyph="&#xE74D;" FontSize="10"  HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                            </MenuItem.Icon>
                                        </MenuItem>
                                    </ContextMenu>
                                </TextBox.ContextMenu>
                            </TextBox>
                            <TextBlock Text="Search players..." 
                                       Foreground="#6b7280" 
                                       IsHitTestVisible="False" 
                                       Margin="12,0,0,0" 
                                       VerticalAlignment="Center" 
                                       FontSize="14">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Text, ElementName=MainSearchBox}" Value="">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            <Button Command="{Binding ClearSearchTextCommand}"
                                    HorizontalAlignment="Right" VerticalAlignment="Center"
                                    Width="20" Height="20" Margin="0,0,8,0"
                                    Cursor="Hand"
                                    shell:WindowChrome.IsHitTestVisibleInChrome="True"
                                    Visibility="{Binding Text, ElementName=MainSearchBox, Converter={StaticResource IsNullOrEmptyToVisibilityConverter}}">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Background" Value="Transparent"/>
                                        <Setter Property="BorderThickness" Value="0"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="Transparent" CornerRadius="10">
                                                        <TextBlock Text="✕" Foreground="#8b929a" FontSize="10" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Opacity" Value="0.7"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </Grid>

                        <!-- Right Panel (Action and Window Buttons) -->
                        <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Right">
                            <!-- Action Buttons -->
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Width="32" Height="32" Margin="0,0,8,0" 
                                        Command="{Binding RefreshDataCommand}"
                                        Style="{StaticResource HeaderButton}"
                                        ToolTip="Refresh player data"
                                        Visibility="Collapsed">
                                    <TextBlock Text="🔄" Foreground="#a6a8ab" FontSize="14"/>
                                </Button>
                                <Button Width="32" Height="32" 
                                        Command="{Binding ShowSettingsDialogCommand}"
                                        Style="{StaticResource HeaderButton}"
                                        ToolTip="Settings">
                                    <TextBlock Text="⚙" Foreground="#a6a8ab" FontSize="14"/>
                                </Button>
                            </StackPanel>

                            <!-- Window Controls -->
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="12,0,0,0">
                                <Button Name="MinimizeButton" 
                                        Style="{StaticResource WindowControlButton}" 
                                        Click="MinimizeButton_Click">
                                    <TextBlock Text="−" Foreground="#a6a8ab" FontSize="14" FontWeight="Bold"/>
                                </Button>
                                <Button Name="MaximizeButton" 
                                        Style="{StaticResource WindowControlButton}" 
                                        Click="MaximizeButton_Click">
                                    <TextBlock Text="□" Foreground="#a6a8ab" FontSize="12"/>
                                </Button>
                                <Button Name="CloseButton" 
                                        Style="{StaticResource CloseButton}" 
                                        Click="CloseButton_Click">
                                    <TextBlock Text="✕" Foreground="#a6a8ab" FontSize="10"/>
                                </Button>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Tab Headers -->
                <Border Grid.Row="1" Background="#141518" BorderThickness="0,0,0,1" BorderBrush="#2d2e33">
                    <StackPanel Orientation="Horizontal">
                        <Button Content="{Binding PlayersTabHeader}" 
                                Command="{Binding SelectTabCommand}" 
                                CommandParameter="Players">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource TabButton}">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedTab}" Value="Players">
                                            <Setter Property="Background" Value="#1e1f23"/>
                                            <Setter Property="Foreground" Value="#3b82f6"/>
                                            <Setter Property="BorderBrush" Value="#3b82f6"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        <Button Content="Report" 
                                Command="{Binding SelectTabCommand}" 
                                CommandParameter="Report">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource TabButton}">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedTab}" Value="Report">
                                            <Setter Property="Background" Value="#1e1f23"/>
                                            <Setter Property="Foreground" Value="#3b82f6"/>
                                            <Setter Property="BorderBrush" Value="#3b82f6"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        <Button Content="Console" 
                                Command="{Binding SelectTabCommand}" 
                                CommandParameter="Console">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource TabButton}">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedTab}" Value="Console">
                                            <Setter Property="Background" Value="#1e1f23"/>
                                            <Setter Property="Foreground" Value="#3b82f6"/>
                                            <Setter Property="BorderBrush" Value="#3b82f6"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        <Button Content="DB Search" 
                                Command="{Binding SelectTabCommand}" 
                                CommandParameter="DbSearch">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource TabButton}">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedTab}" Value="DbSearch">
                                            <Setter Property="Background" Value="#1e1f23"/>
                                            <Setter Property="Foreground" Value="#3b82f6"/>
                                            <Setter Property="BorderBrush" Value="#3b82f6"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </StackPanel>
                </Border>

                <!-- Content Area -->
                <Grid Grid.Row="2">
                    <view:PlayersView Visibility="{Binding SelectedTab, Converter={StaticResource EqualityToVisibilityConverter}, ConverterParameter=Players}" />
                    <view:ReportView Visibility="{Binding SelectedTab, Converter={StaticResource EqualityToVisibilityConverter}, ConverterParameter=Report}" />
                    <view:ConsoleView Visibility="{Binding SelectedTab, Converter={StaticResource EqualityToVisibilityConverter}, ConverterParameter=Console}" />
                    <view:DatabaseSearchView Visibility="{Binding SelectedTab, Converter={StaticResource EqualityToVisibilityConverter}, ConverterParameter=DbSearch}" />
                </Grid>
            </Grid>
        </Border>
    </Grid>
</Window>